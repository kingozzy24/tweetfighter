<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Test</title>
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script type="text/javascript">
		var Player1 = {
			hash:"",
			health : 100,
			attack : 0,
			pastInformation : 0,
			user: new Array()
		};
		var Player2 = {
			hash:"",
			health : 100,
			attack : 0,
			pastInformation : 0,
			user: new Array()
		};
		
		$(document).ready(function(){
			$('#button').click(function(){
				start();
			});
			
			$('#textbox').keypress(function(event){
				if (event.which == 13)
					start();
			});
		});
		
		//timer
		function start(){
			Player1.hash = document.getElementById("firstBox").value;
			Player2.hash = document.getElementById("secondBox").value;
			if (Player1.hash.charAt(0) == '#')
				Player1.hash = Player1.hash.substring(1);
			if (Player2.hash.charAt(0) == '#')
				Player2.hash = Player1.hash.substring(1);
			loopWrap();
			var interval =  Math.floor((Math.random()*1000)+3000);
			setInterval(function(){loopWrap()}, interval);
		}
		
		function loopWrap(){
			for(var i = 0; i <2; i++){
				if(i == 0){
					getTweets(Player1);
				}else{
					getTweets(Player2);
				}
			}
		}
		//get tweets
		function getTweets(player) {
			$('#textbox').attr("disabled", true);
			$('#tweets').empty();
			$('#error').empty();
			$('#error').append("Sending request...");
			
			var req = $.ajax({
				type: 'GET',
				dataType: 'jsonp',
				url: 'http://search.twitter.com/search.json?q=%23'+player.hash+"&result_type=recent&rpp=100&include_entities=true&since_id="+player.pastInformation,
				success: function(data) {
					player.pastInformation = data.max_id;
					console.log(data);
					$('#error').empty();
					if (data.results.length == 0)
						$('#error').append("#" + player.hash + " has no tweets :(");
					for (var i = 0; i < data.results.length; i++) {
						createRow(data.results[i]);
						player.user.push(data.results[i].from_user);
					}
					
					//filter array for duplictates, why this is here I don't know
					uniqueArray = myArray.filter(function(elem, pos) {
						return myArray.indexOf(elem) == pos;
					})
					//what do these do?
					$('a').attr('target', '_blank');
					$('#textbox').attr("disabled", false);
				},
				error: function(xhr, status, errorThrown) {
					console.log(errorThrown);
					$('#error').empty();
					$('#error').append("Can't reach @" + handle + ". Is this account private?");
					$('#textbox').attr("disabled", false);
				}
			});
			
			var userReq = $.ajax({
				type: 'GET',
				dataType: 'jsonp',
				url: "https://api.twitter.com/1.1/users/lookup.json?screen_name="+player.user.toString(),
				success: function(data) {
					$('#error').empty();
					for(var i = 0; i < data.lenght; i++){
						player.attack += data.followers_count;
					}
				},
				error: function(xhr, status, errorThrown) {
					console.log(errorThrown);
					$('#error').empty();
					$('#error').append("no");
					$('#textbox').attr("disabled", false);
				}
			});
			console.log(player.attack);
			function createRow(data) {
				var row = document.createElement("tr");
				var user = document.createElement("td");
				var tweet = document.createElement("td");
				
				$(user).append(data.from_user);
				$(tweet).append(data.text);
				$(tweet).append(data.metadata);
				$(row).append(user);
				$(row).append(tweet);
				$('#tweets').append(row);
			}
		}
	</script>
	
	<style type="text/css">
		body {
			font-family: monospace;
			text-align: center;
		}
		table {
			border: 2px solid black;
			border-collapse: collapse;
		}
		td {
			border: 1px solid black;
			padding: 4px;
		}
		#error {
			font-style: italic;
			color: red;
		}
	</style>
</head>

<body>
	<h2>Enter a hashtag!</h2>
	<div>
		<input type="text" id="firstBox" value="#CodeDaySEA">
		<input type="button" id="button" value="Submit">
	</div>
		<input type = "text" id = "secondBox" value = "CodeDaySF">
	<div>
	</div>
	<br>
	<div id="error"></div>
	<table id="tweets" align=center></table>
</body>

</html>