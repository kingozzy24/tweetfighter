<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Test</title>
	
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script type="text/javascript">
		function Player(hash) {
			this.hash = hash;
			this.health = 100;
			this.pastInformation = 0;
			this.numTweets = 0;
		}
		
		Player.prototype.toString = function() {
			return "Health: " + this.health + ", Tweets: " + this.numTweets;
		}
		
		$(document).ready(function(){
			$('#button').click(function(){
				start();
			});
			
			$('#textbox').keypress(function(event){
				if (event.which == 13)
					start();
			});
		});
		
		//timer
		function start(){
			player1 = new Player(document.getElementById("firstBox").value);
			player2 = new Player(document.getElementById("secondBox").value);
			if (player1.hash.charAt(0) == '#')
				player1.hash = player1.hash.substring(1);
			if (player2.hash.charAt(0) == '#')
				player2.hash = player2.hash.substring(1);

			var interval =  Math.floor((Math.random()*1000)+3000);
			setInterval(function(){update()}, interval);
		}
		
		function update() {
			getTweets(player1);
			getTweets(player2);
			player1.health -= player2.numTweets;
			player2.health -= player1.numTweets;
			debugInfo();
			console.log(Player1);
			console.log(Player2);
		}
		
		//get tweets
		function getTweets(player) {
			$('#tweets').empty();
			$('#error').empty();
			$('#error').append("Sending request...");
			
			var req = $.ajax({
				type: 'GET',
				dataType: 'jsonp',
				url: 'http://search.twitter.com/search.json?q=%23'+player.hash+"&result_type=recent&rpp=100&include_entities=true&since_id="+player.pastInformation,
				success: function(data) {
					player.numTweets = 0;
					player.pastInformation = data.max_id;
					console.log(data);
					$('#error').empty();
					if (data.results.length == 0)
						$('#error').append("#" + player.hash + " has no tweets :(");
					for (var i = 0; i < data.results.length; i++) {
						player.numTweets++;
//						if(player.user.indexOf(temp) == -1){
//							player.user.push(temp.from_user);
//						}
					}
				},
				error: function(xhr, status, errorThrown) {
					player.numTweets = 0;
					console.log(errorThrown);
					$('#error').empty();
					$('#error').append("Error :(. Try again?");
					$('#textbox').attr("disabled", false);
				}
			});
		}
//			var userReq = $.ajax({
//				type: 'GET',
//				dataType: 'jsonp',
//				url: "https://api.twitter.com/1/users/show.json?screen_name="+player.user.toString(),
//				success: function(data) {
//					$('#error').empty();
//					for(var i = 0; i < data.lenght; i++){
//						player.attack += data.followers_count;
//					}
//				},
//				error: function(xhr, status, errorThrown) {
//					console.log(errorThrown);
//					$('#error').empty();
//					$('#error').append("no");
//					$('#textbox').attr("disabled", false);
//				}
//			});
//			console.log(player.attack);
		function debugInfo() {
			$('#tweets').empty();
			var row = document.createElement("tr");
			var d1 = document.createElement("td");
			var d2 = document.createElement("td");
			
			$(d1).append(player1.toString());
			$(d2).append(player2.toString());
			$(row).append(d1);
			$(row).append(d2);
			$('#tweets').append(row);
		}
	</script>
	
	<style type="text/css">
		body {
			font-family: monospace;
			text-align: center;
		}
		table {
			border: 2px solid black;
			border-collapse: collapse;
		}
		td {
			border: 1px solid black;
			padding: 4px;
		}
		#error {
			font-style: italic;
			color: red;
		}
	</style>
</head>

<body>
	<h2>Enter a hashtag!</h2>
	<div>
		<input type="text" id="firstBox" value="#CodeDaySEA">
		<input type="button" id="button" value="Submit">
	</div>
		<input type = "text" id = "secondBox" value = "CodeDaySF">
	<div>
	</div>
	<br>
	<div id="error"></div>
	<table id="tweets" align=center></table>
</body>

</html>